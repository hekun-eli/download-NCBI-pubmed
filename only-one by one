import os
import time
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from webdriver_manager.chrome import ChromeDriverManager

# é…ç½®æ–‡ä»¶è·¯å¾„
# é…ç½®é“¾æ¥æ–‡ä»¶ï¼Œæ”¾åœ¨æ­¤å¤„
link_file = "/Users/link.txt"
# é…ç½®è¾“å‡ºæ–‡ä»¶å¤¹
save_dir = "/Users/out"

# ç¡®ä¿ä¿å­˜è·¯å¾„å­˜åœ¨
os.makedirs(save_dir, exist_ok=True)

# é…ç½® Chrome ä¸‹è½½ PDF è€Œä¸æ˜¯é¢„è§ˆ
chrome_options = Options()
prefs = {
    "plugins.always_open_pdf_externally": True,   # ç›´æ¥ä¸‹è½½ PDF
    "download.default_directory": save_dir,       # ä¸‹è½½ç›®å½•
    "download.prompt_for_download": False,        # ä¸å¼¹çª—
}
chrome_options.add_experimental_option("prefs", prefs)
chrome_options.add_argument("--headless=new")    # å¯å»æ‰æ­¤è¡Œä»¥å¯è§†åŒ–æ‰“å¼€æµè§ˆå™¨
chrome_options.add_argument("--disable-gpu")

# å¯åŠ¨æµè§ˆå™¨
driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=chrome_options)

# é€è¡Œè¯»å–å¹¶å¤„ç†é“¾æ¥
with open(link_file, "r") as f:
    links = [line.strip() for line in f if line.strip()]

print(f"ğŸ“„ å…± {len(links)} æ¡é“¾æ¥å¾…ä¸‹è½½...\n")

for i, url in enumerate(links, 1):
    print(f"ğŸ“¥ æ­£åœ¨å¤„ç†ç¬¬ {i}/{len(links)} æ¡: {url}")

    try:
        driver.get(url)  # æ‰“å¼€é“¾æ¥
        time.sleep(5)    # ç­‰å¾…è·³è½¬ä¸ä¸‹è½½å¼€å§‹

        # å†ç­‰ä¸€ä¼šç¡®ä¿ä¸‹è½½å®Œæˆ
        time.sleep(8)
    except Exception as e:
        print(f"âš ï¸  ä¸‹è½½å¤±è´¥: {url} -> {e}")
    else:
        print("âœ… ä¸‹è½½å®Œæˆ")
    finally:
        time.sleep(3)  # æ¯ä¸ªé“¾æ¥ä¹‹é—´åœé¡¿ï¼Œé˜²æ­¢å¡é¡¿æˆ–è¢«å°

driver.quit()
print("\nğŸ‰ å…¨éƒ¨ä»»åŠ¡å®Œæˆï¼PDF ä¿å­˜åœ¨:", save_dir)
